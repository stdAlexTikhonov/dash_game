!function(t){var i={};function s(h){if(i[h])return i[h].exports;var e=i[h]={i:h,l:!1,exports:{}};return t[h].call(e.exports,e,e.exports,s),e.l=!0,e.exports}s.m=t,s.c=i,s.d=function(t,i,h){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:h})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var h=Object.create(null);if(s.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var e in t)s.d(h,e,function(i){return t[i]}.bind(null,e));return h},s.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=2)}([function(t,i,s){},,function(t,i,s){"use strict";s.r(i),s.d(i,"stopGame",(function(){return v}));s(0),s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p;var h=s.p+"feb29411ccb5b64d73d2cf2746c650ab.png",e=s.p+"3ea8a584a99b1acb8483b0e65eafa29c.png",r=s.p+"cfb1642227edb037caf967a542ad222d.png",a=s.p+"825b18f1a6ec54549e8e75a5ab406f68.png",n=s.p+"d5ad4ae036c1835503ec82da71c820a9.png",c=s.p+"18ba48fa15fbeb9297d54eb8085c4890.png";s.p,s.p,s.p,s.p,s.p;const l="UP",o="DOWN",y="LEFT",d="RIGHT",f=[l,o,y,d],p=" ",_=[a,n,c];let u=2;function x(){let t=1e4*Math.sin(u++);return t-Math.floor(t)}class g{constructor(t,i){this.x=t,this.y=i,this.dir=null,this.EMPTIES=[],this.state=0,this.force=!1,this.time_to_sleep=!1,this.pic_sequence=_,this.img=new Image,this.img.src=h,this.img.width=100,this.img.height=32,this.merphy_state="STOP",this.dy=0}check(t,i){return[p,"*","."].includes(i[t.y][t.x])}check_force_move_left(t){return"O"===t[this.y][this.x-1]&&t[this.y][this.x-2]===p&&this.force}check_force_move_right(t){return"O"===t[this.y][this.x+1]&&t[this.y][this.x+2]===p&&this.force}changePic(t){switch(this.state<2?this.state+=1:this.state=0,this.merphy_state){case"STOP":this.dy=1;break;case"MOVE_LEFT":this.dy=0;break;case"MOVE_RIGHT":this.dy=2;break;default:this.dy=0}}changeState(t){if(g.off)return!1;switch(this.dir){case l:this.check({x:this.x,y:this.y-1},t)?(this.merphy_state="MOVE_UP",this.y-=1,this.EMPTIES.some(t=>t.x===this.x&&t.y===this.y)||this.EMPTIES.push({x:this.x,y:this.y})):this.merphy_state="STOP";break;case o:this.check({x:this.x,y:this.y+1},t)?(this.y+=1,this.merphy_state="MOVE_DOWN",this.EMPTIES.some(t=>t.x===this.x&&t.y===this.y)||this.EMPTIES.push({x:this.x,y:this.y})):this.merphy_state="STOP";break;case y:this.check({x:this.x-1,y:this.y},t)?(this.merphy_state="MOVE_LEFT",this.x-=1,this.EMPTIES.some(t=>t.x===this.x&&t.y===this.y)||this.EMPTIES.push({x:this.x,y:this.y})):this.check_force_move_left(t)?this.x-=1:this.merphy_state="STOP";break;case d:this.check({x:this.x+1,y:this.y},t)?(this.merphy_state="MOVE_RIGHT",this.x+=1,this.EMPTIES.some(t=>t.x===this.x&&t.y===this.y)||this.EMPTIES.push({x:this.x,y:this.y})):this.check_force_move_right(t)?this.x+=1:this.merphy_state="STOP"}}}g.off=!1,g.flag=!0;class m{constructor(t,i){this.phases="/-\\|",this.state=0,this.show="/",this.x=i,this.y=t,this.dir_down=!0,this.dir_left=!1,this.dir_up=!1,this.dir_right=!1,this.dir=o,this.flag=!1,this.still_alive=!0,this.img=new Image,this.img.src=r,this.char="X"}looking_around(t){this.dir_left=t[this.y][this.x-1]===p&&!"*O".includes(t[this.y-1][this.x-1]),this.dir_up=t[this.y-1][this.x]===p,this.dir_right=t[this.y][this.x+1]===p&&!"*O".includes(t[this.y-1][this.x+1]),this.dir_down=t[this.y+1][this.x]===p}find_player(t){const i="A"===t[this.y][this.x-1],s="A"===t[this.y-1][this.x],h="A"===t[this.y][this.x+1];return"A"===t[this.y+1][this.x]||s||i||h}find_rock(t){return"O"===t[this.y-1][this.x]}check_dir(){switch(this.dir){case o:this.dir_left?this.dir=y:this.dir_down?this.dir=o:this.dir_right?this.dir=d:this.dir=l;break;case d:this.dir_down?this.dir=o:this.dir_right?this.dir=d:this.dir_up?this.dir=l:this.dir=y;break;case l:this.dir_right?this.dir=d:this.dir_up?this.dir=l:this.dir_left?this.dir=y:this.dir=o;break;case y:this.dir_up?this.dir=l:this.dir_left?this.dir=y:this.dir_down?this.dir=o:this.dir=d}}no_way(){return!(this.dir_up||this.dir_down||this.dir_left||this.dir_right)}changeState(t){switch(this.state=this.state<7?this.state+1:0,this.show=this.phases[this.phase],this.flag=!this.flag,(this.find_rock(t)||this.no_way())&&(this.still_alive=!1),this.find_player(t)&&(this.still_alive=!1,g.off=!0),this.flag&&this.looking_around(t),this.flag&&this.check_dir(),this.dir){case o:this.flag&&t[this.y+1][this.x]===p&&(this.y+=1);break;case d:this.flag&&t[this.y][this.x+1]===p&&(this.x+=1);break;case l:this.flag&&t[this.y-1][this.x]===p&&(this.y-=1);break;case y:this.flag&&t[this.y][this.x-1]===p&&(this.x-=1)}}}class w{constructor(t,i){this.x=i,this.y=t,this.killer=!1,this.falling=!1}check_way_down(t){return this.falling&&"A"===t[this.y+1][this.x]?(this.killer=!0,g.off=!0):this.falling&&"/-|\\".includes(t[this.y+1][this.x])&&(this.killer=!0),this.falling=!0,t[this.y+1][this.x]===p}move_possible(t){return["+","O","*"].includes(t[this.y+1][this.x])&&!["O","*"].includes(t[this.y-1][this.x])}check_way_left(t){return this.falling=!0,t[this.y][this.x-1]===p&&t[this.y+1][this.x-1]===p&&!["O","*"].includes(t[this.y-1][this.x-1])}check_way_right(t){return this.falling=!0,t[this.y][this.x+1]===p&&t[this.y+1][this.x+1]===p&&!["O","*"].includes(t[this.y-1][this.x+1])}check_force_move_left(t){return t[this.y][this.x-1]===p&&"A"===t[this.y][this.x+1]}check_force_move_right(t){return t[this.y][this.x+1]===p&&"A"===t[this.y][this.x-1]}changeState(t,i){"A"===t[this.y][this.x]&&(this.killer=!0,g.off=!0),this.check_way_down(t)?this.y+=1:this.check_force_move_left(t)&&i?this.x-=1:this.check_force_move_right(t)&&i?this.x+=1:this.move_possible(t)?this.check_way_left(t)?this.x-=1:this.check_way_right(t)?this.x+=1:this.falling=!1:this.falling=!1}}class S{constructor(t,i){this.x=i,this.y=t,this.still_here=!0,this.falling=!1,this.killer=!1}check_way_down(t){return this.falling&&"A"===t[this.y+1][this.x]?(this.killer=!0,g.off=!0):this.falling&&"/-|\\".includes(t[this.y+1][this.x])&&(this.killer=!0),this.falling=!0,t[this.y+1]&&t[this.y+1][this.x]===p}move_possible(t){return t[this.y+1]&&["+","O","*"].includes(t[this.y+1][this.x])&&!["O","*"].includes(t[this.y-1][this.x])}check_way_left(t){return this.falling=!0,t[this.y][this.x-1]===p&&t[this.y+1][this.x-1]===p&&!["O","*"].includes(t[this.y-1][this.x-1])}check_way_right(t){return this.falling=!0,t[this.y][this.x+1]===p&&t[this.y+1][this.x+1]===p&&!["O","*"].includes(t[this.y-1][this.x+1])}changeState(t){"A"===t[this.y][this.x]?this.still_here&&(S.scores+=1,this.still_here=!1):this.check_way_down(t)?this.y+=1:this.move_possible(t)?this.check_way_left(t)?this.x-=1:this.check_way_right(t)?this.x+=1:this.falling=!1:this.falling=!1}}S.scores=0;class k{constructor(t,i,s,h,r,a){this.rand_positions=[],this.height=t,this.width=i,this.minutes=0,this.seconds=0,this.img=new Image,this.img.src=e,this.timer=null,this.pause=!1,this.canvas=document.createElement("canvas"),this.canvas.width=960,this.canvas.height=576,this.ctx=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.BREAKS=[];for(let t=0;t<a;t++){const t=this.rndomizer();this.BREAKS.push(t)}this.PREDATORS=[];for(let t=0;t<s;t++){const t=this.rndomizer();this.PREDATORS.push(new m(t.y,t.x))}this.ROCKS=[];for(let t=0;t<h;t++){const t=this.rndomizer();this.ROCKS.push(new w(t.y,t.x)),this.ROCKS.sort((t,i)=>t.y-i.y)}this.STARS=[];for(let t=0;t<r;t++){const t=this.rndomizer();this.STARS.push(new S(t.y,t.x)),this.STARS.sort((t,i)=>t.y-i.y)}this.GROUND=[];for(let t=0;t<250;t++){const t=this.rndomizer();this.GROUND.push({y:t.y,x:t.x})}const n=this.rndomizer();this.player=new g(n.x,n.y),this.world=this.generate(),this.startTimer()}startTimer(){this.timer=setTimeout(()=>{this.seconds++,this.seconds>59&&(this.seconds=0,this.minutes++),this.startTimer()},1e3)}stopTimer(){clearInterval(this.timer)}getTime(){return(this.minutes<10?"0"+this.minutes:this.minutes)+":"+(this.seconds<10?"0"+this.seconds:this.seconds)}generate(){const t=new Array(this.width).fill("#"),i=new Array(this.width).fill("#"),s=new Array(this.width).fill(p);s[0]="#",s[this.width-1]="#";const h=new Array(this.height);for(let t=0;t<this.height;t++)h[t]=s.slice();return h[0]=t,h[this.height-1]=i,this.GROUND.forEach(t=>h[t.y][t.x]="."),this.player.EMPTIES.forEach(t=>h[t.y][t.x]=p),this.PREDATORS.forEach(t=>h[t.y][t.x]=t),this.ROCKS.forEach(t=>h[t.y][t.x]="O"),this.STARS.forEach(t=>h[t.y][t.x]="*"),this.BREAKS.forEach(t=>h[t.y][t.x]="+"),h}rndomizer(){let t=Math.floor(x()*(this.width-2))+1,i=Math.floor(x()*(this.height-2))+1,s={x:t,y:i};for(;this.rand_positions.some(t=>t.x===s.x&&t.y===s.y);)t=Math.floor(x()*(this.width-2))+1,i=Math.floor(x()*(this.height-2))+1,s={x:t,y:i};return this.rand_positions.push(s),s}print(){return this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.world.forEach((t,i)=>{t.forEach((t,s)=>{"#"===t?this.ctx.drawImage(this.img,0,0,32,32,32*s,32*i,32,32):"+"===t?this.ctx.drawImage(this.img,64,0,32,32,32*s,32*i,32,32):"O"===t?this.ctx.drawImage(this.img,96,0,32,32,32*s,32*i,32,32):"*"===t?this.ctx.drawImage(this.img,32,0,32,32,32*s,32*i,32,32):"."===t?this.ctx.drawImage(this.img,128,0,32,32,32*s,32*i,32,32):"X"===t.char?this.ctx.drawImage(t.img,32*t.state,32*(f.indexOf(t.dir)+1),32,32,32*s,32*i,32,32):"A"===t&&this.ctx.drawImage(this.player.img,32*this.player.state,32*this.player.dy,32,32,32*s,32*i,32,32)})}),this.world.map(t=>t.join(p)).join("\n")+"\nscores: "+S.scores+"  Time: "+this.getTime()}check_predators(){this.PREDATORS=this.PREDATORS.filter(t=>t.still_alive)}check_food(){this.STARS=this.STARS.filter(t=>t.still_here)}check_rocks(){this.ROCKS=this.ROCKS.filter(t=>!t.killer)}check_player(){g.off&&g.flag?g.flag=!1:g.flag?this.world[this.player.y][this.player.x]="A":v()}tick(){this.PREDATORS.forEach(t=>t.changeState(this.world)),this.ROCKS.forEach(t=>t.changeState(this.world,this.player.force)),this.STARS.forEach(t=>t.changeState(this.world)),this.player.changeState(this.world),this.player.changePic(this.seconds),this.check_predators(),this.check_food(),this.check_rocks(),this.world=this.generate(),this.check_player()}}let E=0;const T=document.createElement("pre");window.prevStates=[],T.style.margin=0;const O=document.createElement("div");document.body.style.display="flex",document.body.style.alignItems="center",document.body.style.justifyContent="center",O.style.margin="auto",O.style.fontFamily="Roboto",O.style.position="relative",O.style.width="460px",O.style.height="470px",O.id="main",document.body.appendChild(O),window.pause=!1,window.THE_WORLD=null;const b=()=>{E%5==0&&(window.pause||(THE_WORLD.tick(),prevStates.push(THE_WORLD.print()),prevStates.length>10&&(prevStates=prevStates.slice(1,prevStates.length)))),window.requestAnimationFrame(b),E++},v=()=>{THE_WORLD.stopTimer(),R.style.display="flex",P.innerHTML="Your score: "+S.scores+"<br>Your time: "+THE_WORLD.getTime(),R.appendChild(P),document.body.removeChild(THE_WORLD.canvas),O.style.display="block"},R=document.createElement("div");R.style.display="flex",R.style.position="absolute",R.style.top=0,R.style.left=0,R.style.width="460px",R.style.height="470px",R.style.flexDirection="column",R.style.justifyContent="center",R.style.backgroundColor="rgba(255,255,255,0.7)";const A=document.createElement("div");A.innerText="PRESS TO START",A.style.border="1px solid lightgreen",A.style.fontSize="25px",A.style.border="1px solid lightgreen",A.style.fontFamily="Tahoma",A.style.fontWeight="bold",A.style.color="lightgreen",A.style.margin="auto",A.style.cursor="pointer",A.style.padding="15px";const P=document.createElement("div");P.style.fontFamily="Tahoma",P.style.fontSize="15px",P.style.margin="auto",R.appendChild(A),O.appendChild(R),A.onclick=()=>{R.style.display="none",THE_WORLD=new k(18,30,3,10,10,10),g.off=!1,g.flag=!0,S.scores=0,T.innerText=THE_WORLD.print(),prevStates.push(THE_WORLD.print()),O.style.display="none",b()}}]);