!function(t){var s={};function i(e){if(s[e])return s[e].exports;var h=s[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(e,h,function(s){return t[s]}.bind(null,h));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=1)}([function(t,s,i){},function(t,s,i){"use strict";i.r(s),i.d(s,"audio",(function(){return Ot})),i.d(s,"store",(function(){return gt})),i.d(s,"THE_WORLD",(function(){return Et})),i.d(s,"startGame",(function(){return bt})),i.d(s,"draw",(function(){return Tt})),i.d(s,"stopGame",(function(){return Rt}));i(0);var e=i.p+"3e706f7ebc5dbeba855332d41d0d01c8.mp3";const h="UP",r="DOWN",a="LEFT",c="RIGHT",n=[null,h,r,a,c],o=" ",y="RD",l="PC",x="B",d=["#",".","O","+","*"],p="STOP";var f=i.p+"9ad85c46a5a717c940a68d02561aeee4.png";class S{constructor(t,s){this.x=s,this.y=t,this.dir=null,this.EMPTIES=[],this.state=0,this.force=!1,this.time_to_sleep=!1,this.img=new Image,this.img.src=f,this.img.width=100,this.img.height=32,this.merphy_state=p,this.dy=0,this.char="A",this.prev_horizontal_state="MOVE_LEFT",this.animation=!0}check(t,s){return[o,"*",".","A",y,x].includes(s[t.y][t.x].char)}check_left_portal(t,s){return[0,4,5].includes(s[t.y][t.x].state)&&this.dir===a&&"PO"===s[t.y][t.x].char&&this.check({...t,x:t.x-1},s)}check_right_portal(t,s){return[2,4,5].includes(s[t.y][t.x].state)&&this.dir===c&&"PO"===s[t.y][t.x].char&&this.check({...t,x:t.x+1},s)}check_bottom_portal(t,s){return[1,3,5].includes(s[t.y][t.x].state)&&this.dir===r&&"PO"===s[t.y][t.x].char&&this.check({...t,y:t.y+1},s)}check_top_portal(t,s){return[3,5].includes(s[t.y][t.x].state)&&this.dir===h&&"PO"===s[t.y][t.x].char&&this.check({...t,y:t.y-1},s)}check_predator(t,s){return"X"===s[t.y][t.x].char||"::"===s[t.y][t.x].char}check_force_move_left(t){return["O","OD","YD"].includes(t[this.y][this.x-1].char)&&t[this.y][this.x-2].char===o&&this.force}check_force_move_right(t){return["O","OD","YD"].includes(t[this.y][this.x+1].char)&&t[this.y][this.x+2].char===o&&this.force}check_force_move_up(t){return["O","OD","YD"].includes(t[this.y-1][this.x].char)&&t[this.y-2][this.x].char===o&&this.force}check_force_move_down(t){return["O","OD","YD"].includes(t[this.y+1][this.x].char)&&t[this.y+2][this.x].char===o&&this.force}check_exit_right(t){return"E"===t[this.y][this.x+1].char&&this.force}check_exit_left(t){return"E"===t[this.y][this.x-1].char&&this.force}check_exit_up(t){return"E"===t[this.y-1][this.x].char&&this.force}check_exit_down(t){return"E"===t[this.y+1][this.x].char&&this.force}changePic(){switch(this.state<2?this.state+=1:this.state=0,this.merphy_state){case p:this.dy=1;break;case"MOVE_LEFT":this.dy=0;break;case"MOVE_RIGHT":this.dy=2;break;case"FORCE_LEFT":this.dy=3,this.state=1;break;case"FORCE_UP":this.dy=3,this.state="MOVE_LEFT"===this.prev_horizontal_state?1:0;break;case"FORCE_RIGHT":this.dy=3,this.state=0;break;case"FORCE_DOWN":this.dy=3,this.state="MOVE_LEFT"===this.prev_horizontal_state?1:0;break;case"MOVE_UP":case"MOVE_DOWN":this.dy="MOVE_LEFT"===this.prev_horizontal_state?0:2;break;case"BOMB_LEFT":this.dy=3,this.state=2;break;case"BOMB_UP":this.dy=4,this.state=0;break;case"BOMB_DOWN":this.dy=4,this.state=1;break;case"BOMB_RIGHT":this.dy=4,this.state=2;break;default:this.dy=0}}changeState(t){if(S.off)return!1;switch(this.dir){case h:this.check_predator({x:this.x,y:this.y-1},t)?S.off=!0:this.check({x:this.x,y:this.y-1},t)?(this.merphy_state="MOVE_UP",this.y-=1,this.EMPTIES.some(t=>t.x===this.x&&t.y===this.y)||this.EMPTIES.push({x:this.x,y:this.y})):this.check_force_move_up(t)?(this.y-=1,this.merphy_state="FORCE_UP"):this.check_exit_up(t)?S.off=!0:this.check_top_portal({x:this.x,y:this.y-1},t)?(this.merphy_state="MOVE_UP",this.y-=2):this.merphy_state=p;break;case r:this.check_predator({x:this.x,y:this.y+1},t)?S.off=!0:this.check({x:this.x,y:this.y+1},t)?(this.y+=1,this.merphy_state="MOVE_DOWN",this.EMPTIES.some(t=>t.x===this.x&&t.y===this.y)||this.EMPTIES.push({x:this.x,y:this.y,char:o})):this.check_force_move_down(t)?(this.y+=1,this.merphy_state="FORCE_DOWN"):this.check_exit_down(t)?S.off=!0:this.check_bottom_portal({x:this.x,y:this.y+1},t)?(this.merphy_state="MOVE_DOWN",this.y+=2):this.merphy_state=p;break;case a:this.check_predator({x:this.x-1,y:this.y},t)?S.off=!0:this.check({x:this.x-1,y:this.y},t)?(this.merphy_state="MOVE_LEFT",this.x-=1,this.EMPTIES.some(t=>t.x===this.x&&t.y===this.y)||this.EMPTIES.push({x:this.x,y:this.y,char:o})):this.check_force_move_left(t)?(this.x-=1,this.merphy_state="FORCE_LEFT"):this.check_exit_left(t)?S.off=!0:this.check_left_portal({x:this.x-1,y:this.y},t)?(this.merphy_state="MOVE_LEFT",this.x-=2):this.merphy_state=p,this.prev_horizontal_state="MOVE_LEFT";break;case c:this.check_predator({x:this.x+1,y:this.y},t)?S.off=!0:this.check({x:this.x+1,y:this.y},t)?(this.merphy_state="MOVE_RIGHT",this.x+=1,this.EMPTIES.some(t=>t.x===this.x&&t.y===this.y)||this.EMPTIES.push({x:this.x,y:this.y,char:o})):this.check_force_move_right(t)?(this.x+=1,this.merphy_state="FORCE_RIGHT"):this.check_exit_right(t)?S.off=!0:this.check_right_portal({x:this.x+1,y:this.y},t)?(this.merphy_state="MOVE_RIGHT",this.x+=2):this.merphy_state=p,this.prev_horizontal_state="MOVE_RIGHT";break;default:gt.getState().space_bar||(this.merphy_state=p)}this.force=!1}}S.off=!1,S.flag=!0;var _=i.p+"527b16df2265fc0b9cadef674adccaac.png";class u{constructor(t,s,i){this.x=s,this.y=t,this.still_here=!0,this.falling=!1,this.right=!1,this.left=!1,this.killer=!1,this.char=y,this.img=new Image,this.img.src=_,this.state=0,this.counter=10,this.count_down=i}check_way_down(t){return this.falling&&"A"===t[this.y+1][this.x].char?(this.killer=!0,S.off=!0):this.falling&&"X"===t[this.y+1][this.x].char&&(this.killer=!0),this.falling=!0,t[this.y+1]&&t[this.y+1][this.x].char===o}move_possible(t){return t[this.y+1]&&["+","O","*"].includes(t[this.y+1][this.x].char)&&!["O","*"].includes(t[this.y-1][this.x].char)}check_way_left(t){return this.falling=!0,t[this.y][this.x-1].char===o&&t[this.y+1][this.x-1].char===o&&!["O","*"].includes(t[this.y-1][this.x-1].char)}check_way_right(t){return this.falling=!0,t[this.y][this.x+1].char===o&&t[this.y+1][this.x+1].char===o&&!["O","*"].includes(t[this.y-1][this.x+1].char)}changeState(t){this.count_down&&(this.state=this.state?0:1),this.counter=this.count_down?this.counter-1:this.counter,this.right=!1,this.left=!1,"A"===t[this.y][this.x].char?this.still_here&&(gt.dispatch({type:"PLUS_ONE_BOMB"}),this.still_here=!1):this.check_way_down(t)?this.y+=1:this.move_possible(t)?this.check_way_left(t)?(this.x-=1,this.left=!0):this.check_way_right(t)?(this.x+=1,this.right=!0):this.falling=!1:this.falling=!1}}document.onkeydown=t=>{const{space_bar:s}=gt.getState();switch(t.keyCode){case 37:[null,a].includes(Et.player.dir)&&(Et.player.force=!0),Et.player.dir=s?null:a,s&&Et.world[Et.player.y][Et.player.x-1].char===l?gt.dispatch({type:"ACTIVATE_COMPUTER"}):s&&(Et.player.merphy_state="BOMB_LEFT",gt.dispatch({type:"PUT_BOMB",bomb:new u(Et.player.y,Et.player.x-1,!0)}));break;case 38:[null,h].includes(Et.player.dir)&&(Et.player.force=!0),Et.player.dir=s?null:h,s&&Et.world[Et.player.y-1][Et.player.x].char===l?gt.dispatch({type:"ACTIVATE_COMPUTER"}):s&&(Et.player.merphy_state="BOMB_UP",gt.dispatch({type:"PUT_BOMB",bomb:new u(Et.player.y-1,Et.player.x,!0)}));break;case 39:[null,c].includes(Et.player.dir)&&(Et.player.force=!0),Et.player.dir=s?null:c,s&&Et.world[Et.player.y][Et.player.x+1].char===l?gt.dispatch({type:"ACTIVATE_COMPUTER"}):s&&(Et.player.merphy_state="BOMB_RIGHT",gt.dispatch({type:"PUT_BOMB",bomb:new u(Et.player.y,Et.player.x+1,!0)}));break;case 40:[null,r].includes(Et.player.dir)&&(Et.player.force=!0),Et.player.dir=s?null:r,s&&Et.world[Et.player.y+1][Et.player.x].char===l?gt.dispatch({type:"ACTIVATE_COMPUTER"}):s&&(Et.player.merphy_state="BOMB_DOWN",gt.dispatch({type:"PUT_BOMB",bomb:new u(Et.player.y+1,Et.player.x,!0)}));break;case 32:gt.dispatch({type:"SET_SPACE_BAR"})}},document.onkeyup=t=>{switch(t.keyCode){case 37:Et.player.dir===a&&(Et.player.dir=null);break;case 38:Et.player.dir===h&&(Et.player.dir=null);break;case 39:Et.player.dir===c&&(Et.player.dir=null);break;case 40:Et.player.dir===r&&(Et.player.dir=null);break;case 32:gt.dispatch({type:"RESET_SPACE_BAR"})}};const m=-1!==navigator.userAgent.indexOf("Mobile")||-1!==navigator.userAgent.indexOf("iPhone")||-1!==navigator.userAgent.indexOf("Android")||-1!==navigator.userAgent.indexOf("Windows Phone");var O=i.p+"7c0c5a95f2c7e69cd9d73f83cce04cad.png";class g{constructor(t,s){this.x=s,this.y=t,this.still_here=!0,this.falling=!1,this.right=!1,this.left=!1,this.killer=!1,this.char="*",this.img=new Image,this.img.src=O,this.state=0}check_way_down(t){return this.falling&&"A"===t[this.y+1][this.x].char?(this.killer=!0,S.off=!0):this.falling&&"X"===t[this.y+1][this.x].char&&(this.killer=!0),this.falling=!0,t[this.y+1]&&t[this.y+1][this.x].char===o}move_possible(t){return t[this.y+1]&&["+","O","*"].includes(t[this.y+1][this.x].char)&&!["O","*"].includes(t[this.y-1][this.x].char)}check_way_left(t){return this.falling=!0,t[this.y][this.x-1].char===o&&t[this.y+1][this.x-1].char===o&&!["O","*"].includes(t[this.y-1][this.x-1].char)}check_way_right(t){return this.falling=!0,t[this.y][this.x+1].char===o&&t[this.y+1][this.x+1].char===o&&!["O","*"].includes(t[this.y-1][this.x+1].char)}changeState(t){this.right=!1,this.left=!1,"A"===t[this.y][this.x].char?this.still_here&&(gt.dispatch({type:"PLUS_ONE"}),this.still_here=!1):this.check_way_down(t)?this.y+=1:this.move_possible(t)?this.check_way_left(t)?(this.x-=1,this.left=!0):this.check_way_right(t)?(this.x+=1,this.right=!0):this.falling=!1:this.falling=!1}}var E=i.p+"a01945b29c92fef458e6aec1e30bfdd4.png";class w{constructor(t,s){this.x=s,this.y=t,this.killer=!1,this.falling=!1,this.char="O",this.right=!1,this.left=!1,this.img=new Image,this.img.src=E}check_way_down(t){return this.falling&&"A"===t[this.y+1][this.x].char?(this.killer=!0,S.off=!0):this.falling&&"X"===t[this.y+1][this.x].char&&(this.killer=!0),t[this.y+1][this.x].char===o}move_possible(t){return["+","O","*"].includes(t[this.y+1][this.x].char)&&!["O","*"].includes(t[this.y-1][this.x].char)}check_way_left(t){return t[this.y][this.x-1].char===o&&t[this.y+1][this.x-1].char===o&&!["O","*"].includes(t[this.y-1][this.x-1].char)}check_way_right(t){return t[this.y][this.x+1].char===o&&t[this.y+1][this.x+1].char===o&&!["O","*"].includes(t[this.y-1][this.x+1].char)}check_force_move_left(t){return t[this.y][this.x-1].char===o&&"A"===t[this.y][this.x+1].char}check_force_move_right(t){return t[this.y][this.x+1].char===o&&"A"===t[this.y][this.x-1].char}changeState(t,s){this.right=!1,this.left=!1,"A"===t[this.y][this.x].char&&(this.killer=!0,S.off=!0),this.check_way_down(t)?(this.falling=!0,this.y+=1):this.check_force_move_left(t)&&s.force&&s.dir===a?(this.x-=1,this.left=!0):this.check_force_move_right(t)&&s.force&&s.dir===c?(this.x+=1,this.right=!0):this.move_possible(t)?this.check_way_left(t)?(this.left=!0,this.x-=1):this.check_way_right(t)?(this.right=!0,this.x+=1):(this.falling=!1,this.right=!1,this.left=!1):this.falling=!1}}var b=i.p+"92a519d420e3993935550d4b6d0fa2c4.png";class k{constructor(t,s){this.x=s,this.y=t,this.killer=!1,this.falling=!1,this.char="OD",this.right=!1,this.left=!1,this.img=new Image,this.img.src=b,this.still_alive=!0}check_way_down(t){return this.falling&&"A"===t[this.y+1][this.x].char?(this.killer=!0,S.off=!0):this.falling&&"X"===t[this.y+1][this.x].char&&(this.killer=!0),t[this.y+1][this.x].char===o}move_possible(t){return["+","O","*"].includes(t[this.y+1][this.x].char)&&!["O","*"].includes(t[this.y-1][this.x].char)}check_way_left(t){return t[this.y][this.x-1].char===o&&t[this.y+1][this.x-1].char===o&&!["O","*"].includes(t[this.y-1][this.x-1].char)}check_way_right(t){return t[this.y][this.x+1].char===o&&t[this.y+1][this.x+1].char===o&&!["O","*"].includes(t[this.y-1][this.x+1].char)}check_force_move_left(t){return t[this.y][this.x-1].char===o&&"A"===t[this.y][this.x+1].char}check_force_move_right(t){return t[this.y][this.x+1].char===o&&"A"===t[this.y][this.x-1].char}find_death(t){const s=["O","*"],i=s.includes(t[this.y-1][this.x].char);s.includes(t[this.y][this.x].char);return i}changeState(t,s){this.right=!1,this.left=!1,this.find_death(t)&&(this.still_alive=!1),"A"===t[this.y][this.x].char&&(this.killer=!0,S.off=!0),this.check_way_down(t)?(this.falling=!0,this.y+=1):this.check_force_move_left(t)&&s.force&&s.dir===a?(this.x-=1,this.left=!0):this.check_force_move_right(t)&&s.force&&s.dir===c?(this.x+=1,this.right=!0):(this.falling&&(this.still_alive=!1),this.falling=!1)}}var T=i.p+"f28b2534dc9665f1d17df1c0985640fb.png";class R{constructor(t,s){this.x=s,this.y=t,this.state=0,this.char=x,this.img=new Image,this.img.src=T,this.run=!1,this.counter=0,this.killer=!1}changeState(){this.counter=this.counter<20?this.counter+1:0,this.state=this.counter<5?this.state+1:0,this.killer=this.counter<5}}var v=i.p+"ae88ba553401f7b18aac0911db0b0529.png";class I{constructor(t,s){this.x=s,this.y=t,this.state=0,this.dy=0,this.char=l,this.img=new Image,this.img.src=v}changeState(){const{activate_detonation:t}=gt.getState();this.state=this.state<7?this.state+1:0,this.dy=t?1:0}}var P=i.p+"cdc64e950cabad09e6c8eaf604420550.png";class A{constructor(t,s,i){this.x=s,this.y=t,this.state=i,this.char="PO",this.img=new Image,this.img.src=P,this.run=!1,this.counter=0,this.killer=!1}changeState(){}}var L=i.p+"cfb1642227edb037caf967a542ad222d.png",B=i.p+"b26f22b038ca19c434035228a4b9fca3.png";class C{constructor(t,s,i){this.state=0,this.x=s,this.y=t,this.dir_down=!0,this.dir_left=!1,this.dir_up=!1,this.dir_right=!1,this.dir=r,this.still_alive=!0,this.img=new Image,this.img.src=i?B:L,this.char=i?"::":"X",this.prev_dir=null,this.animation=!0}looking_around(t){this.dir_left=t[this.y][this.x-1].char===o&&!"*O".includes(t[this.y-1][this.x-1].char),this.dir_up=t[this.y-1][this.x].char===o,this.dir_right=t[this.y][this.x+1].char===o&&!"*O".includes(t[this.y-1][this.x+1].char),this.dir_down=t[this.y+1][this.x].char===o}find_player(t){let s=!1;const i="A"===t[this.y-1][this.x].char,e="A"===t[this.y+1][this.x].char,n="A"===t[this.y][this.x-1].char,o="A"===t[this.y][this.x+1].char,y="A"===t[this.y][this.x].char;switch(this.dir){case h:s=i;break;case r:s=e;break;case a:s=n;break;case c:s=o}return s||y}find_death(t){const s=["O","*","OD"],i=s.includes(t[this.y-1][this.x].char),e=s.includes(t[this.y][this.x].char);return i||e}check_dir(){switch(this.animation=!1,this.dir){case r:this.dir===this.prev_dir&&(this.dir_right?this.dir=c:this.dir_down?this.dir=r:this.dir=a),this.prev_dir=r;break;case c:this.dir===this.prev_dir&&(this.dir_up?this.dir=h:this.dir_right?this.dir=c:this.dir=r),this.prev_dir=c;break;case h:this.dir===this.prev_dir&&(this.dir_left?this.dir=a:this.dir_up?this.dir=h:this.dir=c),this.prev_dir=h;break;case a:this.dir===this.prev_dir&&(this.dir_down?this.dir=r:this.dir_left?this.dir=a:this.dir=h),this.prev_dir=a}}changeState(t){if(this.state=this.state<7?this.state+1:0,this.find_death(t)&&(this.still_alive=!1),this.find_player(t)&&(this.still_alive=!1,S.off=!0),this.looking_around(t),this.check_dir(),this.dir===this.prev_dir)switch(this.dir){case r:t[this.y+1][this.x].char===o&&(this.animation=!0,this.y+=1);break;case c:t[this.y][this.x+1].char===o&&(this.animation=!0,this.x+=1);break;case h:t[this.y-1][this.x].char===o&&(this.animation=!0,this.y-=1);break;case a:t[this.y][this.x-1].char===o&&(this.animation=!0,this.x-=1)}}}var N=i.p+"b7a7772f1a46253899cb6d762d178865.png";class M{constructor(t,s){this.x=s,this.y=t,this.state=0,this.char="F",this.img=new Image,this.img.src=N,this.still_here=!0}changeState(){this.state=this.state+1,this.still_here=this.state<=6}}var D=i.p+"5bef3928d2cde590f2a34700df94ce1f.png";class U{constructor(t,s){this.x=s,this.y=t,this.char="YD",this.img=new Image,this.img.src=D,this.still_alive=!0,this.move=!1}check_force_move_up(t){return t[this.y-1][this.x].char===o&&"A"===t[this.y+1][this.x].char}check_force_move_down(t){return t[this.y+1][this.x].char===o&&"A"===t[this.y-1][this.x].char}check_force_move_left(t){return t[this.y][this.x-1].char===o&&"A"===t[this.y][this.x+1].char}check_force_move_right(t){return t[this.y][this.x+1].char===o&&"A"===t[this.y][this.x-1].char}changeState(t,s){this.move=!1;const{activate_detonation:i}=gt.getState();this.still_alive=!i,this.check_force_move_down(t)&&s.force&&s.dir===r?(this.y+=1,this.move=!0):this.check_force_move_left(t)&&s.force&&s.dir===a?(this.x-=1,this.move=!0):this.check_force_move_right(t)&&s.force&&s.dir===c?(this.x+=1,this.move=!0):this.check_force_move_up(t)&&s.force&&s.dir===h&&(this.y-=1,this.move=!0)}}const K=document.createElement("i");K.className="material-icons waves-effect waves-light",K.innerHTML="p",K.style.color="white",K.addEventListener(m?"touchstart":"click",t=>{const{settings:s}=gt.getState();window.pause?(window.pause=!1,K.innerHTML="p",s.music&&Ot.play(),Tt()):(s.music&&Ot.pause(),window.pause=!0,K.innerHTML="s",window.cancelAnimationFrame(window.myReq))});const X=document.createElement("div");X.style.color="white",X.style.fontFamily="Tahoma",X.style.fontSize="15px";const G=document.createElement("div");G.style.color="white",G.style.fontFamily="Tahoma",G.style.fontSize="15px",G.innerText="0";const F=document.createElement("div");F.style.color="white",F.style.fontFamily="Tahoma",F.style.fontSize="15px",F.innerText="0";const V=document.createElement("div");V.style.color="white",V.style.fontFamily="Tahoma",V.style.fontSize="15px",V.innerText="00:00";const z=document.createElement("div");z.style.display="flex",z.style.width="95%",z.style.position="absolute",z.style.top=0,z.style.left=0,z.style.justifyContent="space-between",z.style.padding="10px",z.appendChild(G),z.appendChild(V),z.appendChild(F);var W=i.p+"037a7986d10035164dff1406a7fb5c49.png",Y=i.p+"4a111355b7aa9ebd7c2b7b2252bf0a4f.png",H=i.p+"2d54b3fbf0c1b6bda1a1551cf96e065c.png",j=i.p+"96201bdc3c32ae84f891cdf6f5b826dc.png";const q=[i.p+"8212eb1635f0e3ba400ab3cdc8b9eff1.png",i.p+"b3bddd1048d54cf9c4ff0f53fd1d7f66.png",i.p+"3f4ea19798928c43e59849620de079f1.png",i.p+"9a8d4632b00eb6c884ea096d59d6322e.png",i.p+"02f4f5deb7d90d64769e86d0b838bf1b.png",i.p+"e76bf9c9ac609d135c0486ae00a26a4c.png",i.p+"3c68ecae12d0af470025326078cee3bd.png",i.p+"b0025d85e8b04193056da9ab48f50457.png",i.p+"25fb4c8524ad76f51dbbca4c8072b5f6.png",i.p+"f0405a44d101c8fa0ccb54bf3563ff7e.png"],J=new Image;J.src=W;const $=new Image;$.src=Y;const Q=new Image;Q.src=H;const Z=new Image;Z.src=j;const tt=q.map(t=>{const s=new Image;return s.src=t,s});let st=1;function it(){let t=1e4*Math.sin(st++);return t-Math.floor(t)}class et{constructor(t,s,i,e,n,y,l,x){let p,_;this.rand_positions=[],this.height=t,this.width=s,this.minutes=0,this.seconds=0,this.timer=null,this.pause=!1,this.start=!l,this.ip=l,this.container=document.createElement("div"),this.container.style.position="relative",this.appendCanvas(),this.selected_values=[],this.mouse_pressed=!1,this.selected_value=o,this.ws=l&&new WebSocket(`ws://${l}:3000`),this.container.appendChild(z),document.body.appendChild(this.container),this.container.onpointerdown=t=>{p=t.offsetX,_=t.offsetY},this.container.onpointerup=t=>{const s=t.offsetX-p,i=t.offsetY-_;Math.abs(s)<Math.abs(i)?t.offsetY>_?(this.player.dir===r?this.player.force=!0:this.player.dir=r,this.world.ws&&this.world.ws.send(JSON.stringify({method:"CD",dir:r,token:this.player.token,x:v.x,y:v.y}))):(this.player.dir===h?this.player.force=!0:this.player.dir=h,this.world.ws&&this.world.ws.send(JSON.stringify({method:"CD",dir:h,token:this.player.token,x:v.x,y:v.y}))):t.offsetX>p?(this.player.dir===c?this.player.force=!0:this.player.dir=c,this.world.ws&&this.world.ws.send(JSON.stringify({method:"CD",dir:c,token:this.player.token,x:v.x,y:v.y}))):(this.player.dir===a?this.player.force=!0:this.player.dir=a,this.world.ws&&this.world.ws.send(JSON.stringify({method:"CD",dir:a,token:this.player.token,x:v.x,y:v.y})))};const m=(t,s)=>{const i=document.createElement("div");return i.style.width="32px",i.style.height="32px",i.style.backgroundImage=`url(${t})`,i.style.backgroundColor="black",i.style.backgroundPositionX=32*s+"px",i.style.margin="20px",i.style.cursor="pointer",i},O=()=>{const t=document.getElementsByClassName("btn");for(let s=0;s<t.length;s++)t[s].style.border="none"},E=document.createElement("div");E.style.width="10%",E.style.border="1px solid black",E.style.height="1152px",E.style.display="flex",E.style.flexDirection="column",E.style.alignItems="center";for(let t=0;t<5;t++){const s=m(J,t);s.className="btn",s.onmousedown=i=>{O(),this.selected_value=d[t],s.style.border="3px solid blue"},E.appendChild(s)}const b=m();b.onmousedown=t=>{O(),b.style.border="3px solid blue",b.className="btn",this.selected_value=o},E.appendChild(b);const T=m(L,0);T.onmousedown=t=>{O(),T.style.border="3px solid blue",T.className="btn",this.selected_value="X"},E.appendChild(T);const v=m(f,0);v.onmousedown=t=>{O(),v.style.border="3px solid blue",v.className="btn",this.selected_value="A"},E.appendChild(v),this.edit_block=E,this.WALLS=[],this.BUGS=[];for(let t=0;t<10;t++){const t=this.rndomizer();this.BUGS.push(new R(t.y,t.x))}this.PARTS=[];for(let t=0;t<q.length;t++){const s=this.rndomizer();this.PARTS.push({y:s.y,x:s.x,char:"P",img:tt[t]})}const P=this.rndomizer();this.player=new S(P.y,P.x),this.player.token="_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);const B=this.rndomizer();this.COMPUTER=new I(B.y,B.x),this.BREAKS=[];for(let t=0;t<y;t++){const t=this.rndomizer();this.BREAKS.push({y:t.y,x:t.x,char:"+",img:$})}this.PORTALS=[];for(let t=0;t<12;t++){const s=this.rndomizer();this.PORTALS.push(new A(s.y,s.x,t%6))}this.PREDATORS=[];for(let t=0;t<i;t++){const t=this.rndomizer();this.PREDATORS.push(new C(t.y,t.x))}this.ELECTRONS=[];for(let t=0;t<2;t++){const t=this.rndomizer();this.ELECTRONS.push(new C(t.y,t.x,!0))}this.ROCKS=[];for(let t=0;t<e;t++){const t=this.rndomizer();this.ROCKS.push(new w(t.y,t.x)),this.ROCKS.sort((t,s)=>t.y-s.y)}this.DISKS=[];for(let t=0;t<20;t++){const t=this.rndomizer();this.DISKS.push(new k(t.y,t.x)),this.DISKS.sort((t,s)=>t.y-s.y)}this.YELLOW_DISKS=[];for(let t=0;t<10;t++){const t=this.rndomizer();this.YELLOW_DISKS.push(new U(t.y,t.x)),this.YELLOW_DISKS.sort((t,s)=>t.y-s.y)}this.STARS=[];for(let t=0;t<n;t++){const t=this.rndomizer();this.STARS.push(new g(t.y,t.x)),this.STARS.sort((t,s)=>t.y-s.y)}this.BOMBS=[];for(let t=0;t<10;t++){const t=this.rndomizer();this.BOMBS.push(new u(t.y,t.x)),this.BOMBS.sort((t,s)=>t.y-s.y)}this.GROUND=[];for(let t=0;t<1200;t++){const t=this.rndomizer();this.GROUND.push({y:t.y,x:t.x,char:".",img:Q})}this.PLAYERS=[],this.EXPLOSIONS=[];const N=this.rndomizer();this.EXIT={x:N.x,y:N.y,char:"E",img:Z},l&&(this.ws.onopen=()=>this.ws.send(JSON.stringify({method:"SET_PLAYER_POSITION",token:this.player.token,player:this.player}))),this.world=this.generate(),l&&(this.ws.onmessage=t=>{try{const s=JSON.parse(t.data);switch(s.method){case"SET_PLAYERS":delete s.players[this.player.token];const t=Object.values(s.players);this.PLAYERS=t.map(t=>{const s=new S(t.y,t.x);return s.token=t.token,s}),Object.keys(s.players).length===x-1&&(this.start=!0);break;case"CD":this.PLAYERS.forEach(t=>{s.token===t.token&&(t.dir=s.dir,t.x=s.x,t.y=s.y)});break;case"CLOSE":delete s.players[this.player.token];const i=Object.values(s.players);this.PLAYERS=i.map(t=>{const s=new S(t.y,t.x);return s.token=t.token,s})}}catch(t){console.log(t)}})}appendCanvas(){const{settings:t}=gt.getState();this.viewport=document.createElement("canvas"),this.viewport.id="viewport",this.viewport.width=t.orientation?352:640,this.viewport.height=t.orientation?640:352,this.ctx_vp=this.viewport.getContext("2d"),this.container.appendChild(this.viewport)}startTimer(){this.timer=setTimeout(()=>{window.pause||(this.seconds++,this.seconds>59&&(this.seconds=0,this.minutes++),V.innerText=this.getTime()),this.startTimer()},1e3)}stopTimer(){clearInterval(this.timer)}getTime(){return(this.minutes<10?"0"+this.minutes:this.minutes)+":"+(this.seconds<10?"0"+this.seconds:this.seconds)}generate(){const t=new Array(this.width).fill({char:"#",img:J}),s=new Array(this.width).fill({char:"#",img:J}),i=new Array(this.width).fill({char:o});i[0]={char:"#",img:J},i[this.width-1]={char:"#",img:J};const e=new Array(this.height);for(let t=0;t<this.height;t++)e[t]=i.slice();return e[0]=t,e[this.height-1]=s,this.GROUND.forEach(t=>e[t.y][t.x]=t),this.BUGS.forEach(t=>e[t.y][t.x]=t),this.player.EMPTIES.forEach(t=>e[t.y][t.x]={char:o}),this.ip&&this.PLAYERS.forEach(t=>{t.EMPTIES.forEach(t=>e[t.y][t.x]={char:o}),e[t.y][t.x]=t}),this.PREDATORS.forEach(t=>e[t.y][t.x]=t),this.ELECTRONS.forEach(t=>e[t.y][t.x]=t),this.ROCKS.forEach(t=>e[t.y][t.x]=t),this.DISKS.forEach(t=>e[t.y][t.x]=t),this.YELLOW_DISKS.forEach(t=>e[t.y][t.x]=t),this.STARS.forEach(t=>e[t.y][t.x]=t),this.BOMBS.forEach(t=>e[t.y][t.x]=t),this.BREAKS.forEach(t=>e[t.y][t.x]=t),this.WALLS.forEach(t=>e[t.y][t.x]=t),this.PARTS.forEach(t=>e[t.y][t.x]=t),this.PLAYERS.forEach(t=>e[t.y][t.x]=t),this.EXPLOSIONS.forEach(t=>e[t.y][t.x]=t),e[this.COMPUTER.y][this.COMPUTER.x]=this.COMPUTER,e[this.EXIT.y][this.EXIT.x]=this.EXIT,this.PORTALS.forEach(t=>e[t.y][t.x]=t),e}rndomizer(t){let s=Math.floor(it()*(this.width-2))+1,i=Math.floor(it()*(this.height-2))+1,e={x:s,y:i};for(;this.rand_positions.some(t=>t.x===e.x&&t.y===e.y);)s=Math.floor(it()*(this.width-2))+1,i=Math.floor(it()*(this.height-2))+1,e={x:s,y:i};return this.rand_positions.push(e),"A"===t&&(this.rand_positions.push({x:e.x-1,y:e.y+1}),this.rand_positions.push({x:e.x-1,y:e.y-1}),this.rand_positions.push({x:e.x-1,y:e.y}),this.rand_positions.push({x:e.x+1,y:e.y+1}),this.rand_positions.push({x:e.x+1,y:e.y-1}),this.rand_positions.push({x:e.x+1,y:e.y}),this.rand_positions.push({x:e.x,y:e.y+1}),this.rand_positions.push({x:e.x,y:e.y-1})),e}print(t){this.ctx_vp.fillStyle="black",this.ctx_vp.fillRect(0,0,this.viewport.width,this.viewport.height);const{settings:s}=gt.getState(),i=this.player.x-Math.floor(s.orientation?5.5:10),e=this.player.y-Math.floor(s.orientation?10:5.5),d=i+(s.orientation?11:20),p=e+(s.orientation?20:11);return this.world.forEach((s,o)=>{const f=o>=e-1&&o<=p;s.forEach((s,p)=>{if(f&&(p>=i-1&&p<=d)){let d=32*(p-i),f=32*(o-e);if(this.player.animation)switch(this.player.merphy_state){case"MOVE_RIGHT":case"FORCE_RIGHT":d-=32/6*t-32;break;case"MOVE_LEFT":case"FORCE_LEFT":d+=32/6*t-32;break;case"MOVE_UP":case"FORCE_UP":f+=32/6*t-32;break;case"MOVE_DOWN":case"FORCE_DOWN":f-=32/6*t-32}switch(s.char){case"X":if(s.animation)switch(s.dir){case c:d+=32/6*t-32;break;case a:d-=32/6*t-32;break;case h:f-=32/6*t-32;break;case r:f+=32/6*t-32}this.ctx_vp.drawImage(s.img,32*s.state,32*n.indexOf(s.dir),32,32,d,f,32,32);break;case"::":if(s.animation)switch(s.dir){case c:d+=32/6*t-32;break;case a:d-=32/6*t-32;break;case h:f-=32/6*t-32;break;case r:f+=32/6*t-32}this.ctx_vp.drawImage(s.img,32*s.state,0,32,32,d,f,32,32);break;case".":this.ctx_vp.drawImage(s.img,d,f,32,32);break;case"#":case"P":case"+":this.ctx_vp.drawImage(s.img,d,f,32,32);break;case"O":case"OD":s.right?d+=32/6*t-32:s.left?d-=32/6*t-32:s.falling&&(f+=32/6*t-32),this.ctx_vp.drawImage(s.img,d,f,32,32);break;case"YD":if(s.move)switch(this.player.merphy_state){case"FORCE_RIGHT":d+=32/6*t-32;break;case"FORCE_LEFT":d-=32/6*t-32;break;case"FORCE_UP":f-=32/6*t-32;break;case"FORCE_DOWN":f+=32/6*t-32}this.ctx_vp.drawImage(s.img,d,f,32,32);break;case"*":case y:s.right?d+=32/6*t-32:s.left?d-=32/6*t-32:s.falling&&(f+=32/6*t-32),this.ctx_vp.drawImage(s.img,32*s.state,0,32,32,d,f,32,32);break;case"A":switch(s.merphy_state){case"MOVE_RIGHT":case"FORCE_RIGHT":d+=32/6*t-32;break;case"MOVE_LEFT":case"FORCE_LEFT":d-=32/6*t-32;break;case"MOVE_UP":case"FORCE_UP":f-=32/6*t-32;break;case"MOVE_DOWN":case"FORCE_DOWN":f+=32/6*t-32}this.ctx_vp.drawImage(s.img,32*s.state,32*s.dy,32,32,d,f,32,32);break;case"F":this.ctx_vp.drawImage(s.img,32*s.state,0,32,32,d,f,32,32);break;case l:this.ctx_vp.drawImage(s.img,32*s.state,32*s.dy,32,32,d,f,32,32);break;case x:this.ctx_vp.drawImage(s.img,32*s.state,0,32,32,d,f,32,32);break;case"E":this.ctx_vp.drawImage(s.img,d,f,32,32);break;case"PO":this.ctx_vp.drawImage(s.img,32*s.state,0,32,32,d,f,32,32)}}})}),this.world.map(t=>t.join(o)).join("\n")+"\nscores: "+gt.getState().score+"  Time: "+this.getTime()}check_predators(){const t=this.PREDATORS.find(t=>!t.still_alive);if(t){this.EXPLOSIONS.push(new M(t.y,t.x)),this.EXPLOSIONS.push(new M(t.y+1,t.x)),this.EXPLOSIONS.push(new M(t.y-1,t.x)),this.EXPLOSIONS.push(new M(t.y,t.x+1)),this.EXPLOSIONS.push(new M(t.y,t.x-1)),this.EXPLOSIONS.push(new M(t.y+1,t.x-1)),this.EXPLOSIONS.push(new M(t.y+1,t.x+1)),this.EXPLOSIONS.push(new M(t.y-1,t.x-1)),this.EXPLOSIONS.push(new M(t.y-1,t.x+1));const s=[{x:t.x,y:t.y},{x:t.x,y:t.y+1},{x:t.x,y:t.y-1},{x:t.x+1,y:t.y},{x:t.x-1,y:t.y},{x:t.x-1,y:t.y+1},{x:t.x+1,y:t.y+1},{x:t.x-1,y:t.y-1},{x:t.x+1,y:t.y-1}];this.GROUND=this.GROUND.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.ROCKS=this.ROCKS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.DISKS=this.DISKS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.STARS=this.STARS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.BOMBS=this.BOMBS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.BUGS=this.BUGS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.BREAKS=this.BREAKS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.PORTALS=this.PORTALS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.PARTS=this.PARTS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),S.off=s.some(t=>t.x===this.player.x&&t.y===this.player.y)}this.PREDATORS=this.PREDATORS.filter(t=>t.still_alive)}check_electrons(){const t=this.ELECTRONS.find(t=>!t.still_alive);if(t){this.STARS.push(new g(t.y,t.x)),this.STARS.push(new g(t.y+1,t.x)),this.STARS.push(new g(t.y-1,t.x)),this.STARS.push(new g(t.y,t.x+1)),this.STARS.push(new g(t.y,t.x-1)),this.STARS.push(new g(t.y+1,t.x-1)),this.STARS.push(new g(t.y+1,t.x+1)),this.STARS.push(new g(t.y-1,t.x-1)),this.STARS.push(new g(t.y-1,t.x+1));const s=[{x:t.x,y:t.y},{x:t.x,y:t.y+1},{x:t.x,y:t.y-1},{x:t.x+1,y:t.y},{x:t.x-1,y:t.y},{x:t.x-1,y:t.y+1},{x:t.x+1,y:t.y+1},{x:t.x-1,y:t.y-1},{x:t.x+1,y:t.y-1}];this.GROUND=this.GROUND.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.ROCKS=this.ROCKS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.DISKS=this.DISKS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.BOMBS=this.BOMBS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.BUGS=this.BUGS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.PORTALS=this.PORTALS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.BREAKS=this.BREAKS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.PARTS=this.PARTS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),S.off=s.some(t=>t.x===this.player.x&&t.y===this.player.y)}this.ELECTRONS=this.ELECTRONS.filter(t=>t.still_alive)}check_food(){this.STARS=this.STARS.filter(t=>t.still_here)}check_bombs(){const{bombs:t}=gt.getState();this.BOMBS=this.BOMBS.filter(t=>t.still_here),t.bomb&&(this.BOMBS.push(t.bomb),gt.dispatch({type:"CLEAR_BOMB"}));const s=this.BOMBS.find(t=>0===t.counter);if(s){this.EXPLOSIONS.push(new M(s.y,s.x)),this.EXPLOSIONS.push(new M(s.y+1,s.x)),this.EXPLOSIONS.push(new M(s.y-1,s.x)),this.EXPLOSIONS.push(new M(s.y,s.x+1)),this.EXPLOSIONS.push(new M(s.y,s.x-1)),this.EXPLOSIONS.push(new M(s.y+1,s.x-1)),this.EXPLOSIONS.push(new M(s.y+1,s.x+1)),this.EXPLOSIONS.push(new M(s.y-1,s.x-1)),this.EXPLOSIONS.push(new M(s.y-1,s.x+1));const t=[{x:s.x,y:s.y},{x:s.x,y:s.y+1},{x:s.x,y:s.y-1},{x:s.x+1,y:s.y},{x:s.x-1,y:s.y},{x:s.x-1,y:s.y+1},{x:s.x+1,y:s.y+1},{x:s.x-1,y:s.y-1},{x:s.x+1,y:s.y-1}];this.GROUND=this.GROUND.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.ROCKS=this.ROCKS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.DISKS=this.DISKS.map(s=>t.some(t=>t.x===s.x&&t.y===s.y)?{...s,still_alive:!1}:s),this.STARS=this.STARS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.ELECTRONS=this.ELECTRONS.map(s=>t.some(t=>t.x===s.x&&t.y===s.y)?{...s,still_alive:!1}:s),this.BOMBS=this.BOMBS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.PORTALS=this.PORTALS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.BUGS=this.BUGS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.BREAKS=this.BREAKS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.PARTS=this.PARTS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),S.off=t.some(t=>t.x===this.player.x&&t.y===this.player.y)}}check_rocks(){this.ROCKS=this.ROCKS.filter(t=>!t.killer)}check_disks(){const t=this.DISKS.find(t=>!t.still_alive);if(t){this.EXPLOSIONS.push(new M(t.y,t.x)),this.EXPLOSIONS.push(new M(t.y+1,t.x)),this.EXPLOSIONS.push(new M(t.y-1,t.x)),this.EXPLOSIONS.push(new M(t.y,t.x+1)),this.EXPLOSIONS.push(new M(t.y,t.x-1)),this.EXPLOSIONS.push(new M(t.y+1,t.x-1)),this.EXPLOSIONS.push(new M(t.y+1,t.x+1)),this.EXPLOSIONS.push(new M(t.y-1,t.x-1)),this.EXPLOSIONS.push(new M(t.y-1,t.x+1));const s=[{x:t.x,y:t.y},{x:t.x,y:t.y+1},{x:t.x,y:t.y-1},{x:t.x+1,y:t.y},{x:t.x-1,y:t.y},{x:t.x-1,y:t.y+1},{x:t.x+1,y:t.y+1},{x:t.x-1,y:t.y-1},{x:t.x+1,y:t.y-1}];this.GROUND=this.GROUND.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.ROCKS=this.ROCKS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.DISKS=this.DISKS.filter(t=>t.still_alive),this.DISKS=this.DISKS.map(t=>s.some(s=>s.x===t.x&&s.y===t.y)?{...t,still_alive:!1}:t),this.BOMBS=this.BOMBS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.PORTALS=this.PORTALS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.BUGS=this.BUGS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.STARS=this.STARS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.BREAKS=this.BREAKS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.PARTS=this.PARTS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),S.off=s.some(t=>t.x===this.player.x&&t.y===this.player.y)}}check_yellow_disks(){this.YELLOW_DISKS.find(t=>!t.still_alive)&&(this.YELLOW_DISKS.forEach(t=>{this.EXPLOSIONS.push(new M(t.y,t.x)),this.EXPLOSIONS.push(new M(t.y+1,t.x)),this.EXPLOSIONS.push(new M(t.y-1,t.x)),this.EXPLOSIONS.push(new M(t.y,t.x+1)),this.EXPLOSIONS.push(new M(t.y,t.x-1)),this.EXPLOSIONS.push(new M(t.y+1,t.x-1)),this.EXPLOSIONS.push(new M(t.y+1,t.x+1)),this.EXPLOSIONS.push(new M(t.y-1,t.x-1)),this.EXPLOSIONS.push(new M(t.y-1,t.x+1));const s=[{x:t.x,y:t.y},{x:t.x,y:t.y+1},{x:t.x,y:t.y-1},{x:t.x+1,y:t.y},{x:t.x-1,y:t.y},{x:t.x-1,y:t.y+1},{x:t.x+1,y:t.y+1},{x:t.x-1,y:t.y-1},{x:t.x+1,y:t.y-1}];this.GROUND=this.GROUND.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.ROCKS=this.ROCKS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.DISKS=this.DISKS.filter(t=>t.still_alive),this.DISKS=this.DISKS.map(t=>s.some(s=>s.x===t.x&&s.y===t.y)?{...t,still_alive:!1}:t),this.BOMBS=this.BOMBS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.BUGS=this.BUGS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.PORTALS=this.PORTALS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.STARS=this.STARS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.BREAKS=this.BREAKS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),this.PARTS=this.PARTS.filter(t=>!s.some(s=>s.x===t.x&&s.y===t.y)),S.off=s.some(t=>t.x===this.player.x&&t.y===this.player.y)}),this.YELLOW_DISKS=[])}check_bugs(){const{x:t,y:s}=this.player,i=this.BUGS.find(i=>t===i.x&&s===i.y&&i.killer);if(i){this.EXPLOSIONS.push(new M(i.y,i.x)),this.EXPLOSIONS.push(new M(i.y+1,i.x)),this.EXPLOSIONS.push(new M(i.y-1,i.x)),this.EXPLOSIONS.push(new M(i.y,i.x+1)),this.EXPLOSIONS.push(new M(i.y,i.x-1)),this.EXPLOSIONS.push(new M(i.y+1,i.x-1)),this.EXPLOSIONS.push(new M(i.y+1,i.x+1)),this.EXPLOSIONS.push(new M(i.y-1,i.x-1)),this.EXPLOSIONS.push(new M(i.y-1,i.x+1));const t=[{x:i.x,y:i.y},{x:i.x,y:i.y+1},{x:i.x,y:i.y-1},{x:i.x+1,y:i.y},{x:i.x-1,y:i.y},{x:i.x-1,y:i.y+1},{x:i.x+1,y:i.y+1},{x:i.x-1,y:i.y-1},{x:i.x+1,y:i.y-1}];this.GROUND=this.GROUND.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.ROCKS=this.ROCKS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.DISKS=this.DISKS.filter(t=>t.still_alive),this.DISKS=this.DISKS.map(s=>t.some(t=>t.x===s.x&&t.y===s.y)?{...s,still_alive:!1}:s),this.BOMBS=this.BOMBS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.BUGS=this.BUGS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.PORTALS=this.PORTALS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.STARS=this.STARS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.BREAKS=this.BREAKS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),this.PARTS=this.PARTS.filter(s=>!t.some(t=>t.x===s.x&&t.y===s.y)),S.off=!0}const e=this.BUGS.find(i=>t===i.x&&s===i.y);e&&(this.BUGS=this.BUGS.filter(t=>t.x!==e.x&&t.y!==e.y))}check_player(){if(S.off&&S.flag)S.flag=!1;else if(S.flag)this.world[this.player.y][this.player.x]=this.player;else{this.player.animation=!1;const t=setTimeout(()=>{Rt(),clearTimeout(t)},1e3);V.innerText="00:00"}}check_explosions(){this.EXPLOSIONS=this.EXPLOSIONS.filter(t=>t.still_here)}tick(){this.PREDATORS.forEach(t=>t.changeState(this.world)),this.ELECTRONS.forEach(t=>t.changeState(this.world)),this.ROCKS.forEach(t=>t.changeState(this.world,this.player)),this.DISKS.forEach(t=>{t.changeState&&t.changeState(this.world,this.player)}),this.YELLOW_DISKS.forEach(t=>{t.changeState&&t.changeState(this.world,this.player)}),this.STARS.forEach(t=>t.changeState(this.world)),this.BOMBS.forEach(t=>t.changeState(this.world)),this.BUGS.forEach(t=>t.changeState()),this.EXPLOSIONS.forEach(t=>t.changeState()),this.ip&&this.PLAYERS.forEach(t=>{t.changeState(this.world),t.changePic()}),this.player.changeState(this.world),this.player.changePic(),this.COMPUTER.changeState(),this.check_food(),this.check_bombs(),this.world=this.generate(),this.check_player(),this.check_predators(),this.check_electrons(),this.check_rocks(),this.check_disks(),this.check_yellow_disks(),this.check_bugs(),this.check_explosions()}}var ht=i.p+"e3d96bbf72c697c76444ab5cc598a2f0.png",rt=i.p+"29196c45d0a70a7e3be257476344f874.png",at=i.p+"a4314b32bfa2f63a5ef5e432ba90fae1.png";const ct=[{name:"Music",initial:!1,action:"TOGGLE_MUSIC",mobile:!0,img_on:rt,img_off:ht},{name:"Orientation",initial:!0,action:"TOGGLE_ORIENTATION",mobile:!1,img_on:i.p+"f1155266d2d5e4ac6a010a776daa3a34.png",img_off:at}],nt=document.createElement("div");nt.style.display="flex",nt.style.justifyContent="space-around",nt.style.alignItems="flex-start",nt.style.fontFamily="Roboto",nt.style.position="relative",nt.style.width="100%",nt.style.height="100vh",nt.style.paddingTop="50px",nt.style.overflow="auto",nt.style.position="absolute",nt.style.top=0,nt.style.left=0,nt.style.background="black";(m?ct.filter(t=>t.mobile):ct).forEach(t=>{const s=document.createElement("div");s.style.height="50px",s.style.width="50px",s.style.backgroundSize="100%",s.style.backgroundImage=`url(${t.initial?t.img_on:t.img_off})`,s.addEventListener(m?"touchstart":"click",i=>{gt.dispatch({type:t.action});const{settings:e}=gt.getState();"Music"===t.name?s.style.backgroundImage=`url(${e.music?t.img_on:t.img_off})`:"Orientation"===t.name&&(s.style.backgroundImage=`url(${e.orientation?t.img_on:t.img_off})`)}),nt.appendChild(s)});const ot=document.createElement("div");ot.style.color="white",ot.innerHTML="x",ot.style.position="absolute",ot.style.top="10px",ot.style.right="10px",ot.style.fontSize="40px",ot.style.lineHeight="20px",ot.addEventListener(m?"touchstart":"click",()=>{document.body.removeChild(nt)}),nt.appendChild(ot);const yt=document.createElement("div");yt.style.display="flex",yt.style.flexDirection="column",yt.style.justifyContent="center",yt.style.alignItems="center",yt.style.fontFamily="Roboto",yt.style.position="relative",yt.style.width="100%",yt.style.height="100vh";const lt=document.createElement("div");lt.innerText="PRESS TO START",lt.style.border="1px solid lightgreen",lt.style.fontSize="25px",lt.style.border="1px solid lightgreen",lt.style.fontFamily="Tahoma",lt.style.fontWeight="bold",lt.style.color="lightgreen",lt.style.cursor="pointer",lt.style.padding="15px",lt.style.margin="5px",lt.style.textTransform="uppercase",lt.style.minWidth="250px";const xt=lt.cloneNode(!0);xt.innerText="Settings",yt.appendChild(lt),yt.appendChild(xt),yt.appendChild(X),lt.addEventListener(m?"touchstart":"click",()=>{const{settings:t}=gt.getState();bt(),t.music&&Ot.play()}),xt.addEventListener(m?"touchstart":"click",()=>{document.body.appendChild(nt)});const dt={music:!1,orientation:!0},pt=(t=dt,s)=>{switch(s.type){case"TOGGLE_MUSIC":return{...t,music:!t.music};case"TOGGLE_ORIENTATION":return{...t,orientation:!t.orientation};default:return t}},ft=(t=0,s)=>{switch(s.type){case"PLUS_ONE":return t+1;case"RESET_SCORE":return 0;default:return t}},St={quantity:0,bomb:null},_t=(t=St,s)=>{switch(s.type){case"PLUS_ONE_BOMB":return{...t,quantity:t.quantity+1};case"PUT_BOMB":return{bomb:t.quantity>0?s.bomb:null,quantity:t.quantity>0?t.quantity-1:0};case"RESET_BOMBS":return St;case"CLEAR_BOMB":return{...t,bomb:null};default:return t}},ut=(t=!1,s)=>{switch(s.type){case"SET_SPACE_BAR":return!0;case"RESET_SPACE_BAR":return!1;default:return t}},mt=(t=!1,s)=>{switch(s.type){case"ACTIVATE_COMPUTER":return!0;case"RESET_ACTIVATION":return!1;default:return t}},Ot=new Audio(e),gt=(t=>{let s,i=[];return{getState:()=>s,subscribe:t=>(i.push(t),()=>{i=i.filter(s=>s!==t)}),dispatch:e=>{s=t(s,e),i.forEach(t=>t())}}})((t={},s)=>({settings:pt(t.settings,s),score:ft(t.score,s),bombs:_t(t.bombs,s),space_bar:ut(t.space_bar,s),activate_detonation:mt(t.activate_detonation,s)}));gt.dispatch({type:"RESET_SCORE"}),gt.dispatch({type:"RESET_BOMBS"});let Et,wt=0;window.prevStates=[],document.body.appendChild(yt),window.pause=!1,window.myReq=null,gt.subscribe(()=>{const{settings:t,score:s,bombs:i}=gt.getState();t.music?Ot.play():t.music||Ot.pause(),G.innerText=s,F.innerText=i.quantity});const bt=(t,s)=>{gt.dispatch({type:"RESET_SCORE"}),Et=new et(36,60,6,40,40,40,t,s),S.off=!1,S.flag=!0,gt.dispatch({type:"RESET_BOMBS"}),gt.dispatch({type:"RESET_ACTIVATION"}),prevStates.push(Et.print()),document.body.removeChild(yt),window.pause=!1,Et.startTimer(),Tt()};let kt=0;const Tt=()=>{window.pause||(wt%6==0&&Et.start&&Et.tick(),prevStates.push(Et.print(kt)),prevStates.length>10&&(prevStates=prevStates.slice(1,prevStates.length)),kt=kt<5?kt+1:0),window.pause||(window.myReq=window.requestAnimationFrame(Tt)),wt++},Rt=()=>{const{score:t}=gt.getState();Et.stopTimer(),Et.ws&&Et.ws.send(JSON.stringify({method:"CLOSE",token:Et.player.token})),window.cancelAnimationFrame(window.myReq),window.pause=!0,X.innerHTML="Your score: "+t+"<br>Your time: "+Et.getTime(),Et.container.parentNode&&document.body.removeChild(Et.container),document.body.appendChild(yt)};window.addEventListener("orientationchange",(function(){gt.dispatch({type:"TOGGLE_ORIENTATION"}),Et.container.removeChild(Et.viewport),Et.appendCanvas()}))}]);